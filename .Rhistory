encoding()
Encoding()
rm(list=ls())
x <- c(3,4,1,7,15,12)
y <- c(5.5, 7, 8, 10.5, 16, 13.5)
i <- rep(1,6)
# OLS
X <- matrix(x)
# OLS
X <- matrix(x, y)
# OLS
X <- matrix(c(x,y))
# OLS
X <- matrix(i,x)
X
# OLS
X <- rbind(i,x)
# OLS
X <- cbind(i,x)
# OLS
X <- matrix(c(i,x),nrow = 6)
X
# transpose and multiply
Xt <- t(X)
Xt
Xt*X
Xt%*%X
# determinante
det(XtX)
XtX <- Xt%*%X
det(XtX)
# determinante
det <- det(XtX)
# (X'X)^-1
XtX1 <- 1/det*XtX
XtX1
#
P <- XtX1 %*% Xt
P
# beta
b <- P%*%y
b
data.frame(x,y)
df <- data.frame(x,y)
lm(y~x, data = df)
lm(x ~ y, data = df)
lm(y ~ x, data = df)
b <- P%*%y
b
P
X
Xt
XtX
det <- det(XtX)
det
# (X'X)^-1
XtX1 <- (1/det)*XtX
XtX1
XtX1 <- (1/det)%*%XtX
P <- XtX1 %*% Xt
P
P%*%y
lm1 <- lm(y ~ x, data = df)
summary(lm1)
?lm
lm1$x
lm1$model
lm1 <- lm(y ~ 1 + x, data = df)
summary(lm1)
b
lm1 <- lm(y ~ x -1, data = df)
summary(lm1)
x
solve( (t(X)%*%X) ) %*% t(X)%*%y
# (X'X)^-1
XtX1 <- inv(XtX)
# (X'X)^-1
XtX1 <- solve(XtX)
XtX1
P <- XtX1 %*% Xt
b <- P%*%y
b
# compare with lm()
(lm1 <- lm(y ~ x, data = df))
## within and between projetion matrix
# dummy design matrix NT x N
i1 <- c(1,1,0,0,0,0)
i2 <- c(0,0,1,1,0,0)
i3 <- c(0,0,0,0,1,1)
Z <- matrix(c(i1,i2,i3,nrow=3
Z
Z <- matrix(c(i1,i2,i3,nrow=3)
Z
Z <- matrix(c(i1,i2,i3,nrow=3))
Z
Z <- matrix(c(i1,i2,i3),nrow=6)
Z
# Projection Matrix
Proj <- Z%*%solve(Z%*%t(Z))%*%t(Z)
# Projection Matrix
Proj <- Z%*%solve(t(Z)%*%Z)%*%t(Z)
Proj
# Projection Matrix
P_with <- Z%*%solve(t(Z)%*%Z)%*%t(Z)
it1 <- c(1,0,1,0,1,0)
it1 <- c(1,0,1,0,1,0)
it2 <- c(0,1,0,1,0,1)
Z2 <- matrix(c(it1,it2),nrow=6)
P_with <- Z2%*%solve(t(Z2)%*%Z2)%*%t(Z2)
P_with
P_bet <- Z%*%solve(t(Z)%*%Z)%*%t(Z)
P_bet
it1 <- c(1,0,1,0,1,0)
it2 <- c(0,1,0,1,0,1)
Z2
it1 <- c(1,0,1,0,1,0)
it2 <- c(0,1,0,1,0,1)
Z2 <- matrix(c(it1,it2),nrow=6)
P_with <- Z2%*%solve(t(Z2)%*%Z2)%*%t(Z2)
P_with
# Projection Matrix within
diag(6)
identity <- diag(6)
identity - P_bet
rm(list=ls())
# define variables
x <- c(3, 4, 1, 7, 15, 12)
y <- c(5.5, 7, 8, 10.5, 16, 13.5)
i <- rep(1,6)
## within and between projetion matrix
# dummy design matrix NT x N
i1 <- c(1,1,0,0,0,0)
i2 <- c(0,0,1,1,0,0)
i3 <- c(0,0,0,0,1,1)
Z <- matrix(c(i1,i2,i3),nrow=6)
# Projection Matrix with unit specific means (between)
P_bet <- Z%*%solve(t(Z)%*%Z)%*%t(Z)
identity <- diag(6)
identity - P_bet
## c) within estimator and variance covariance matrix
#
P_with %*% y
P_with <- identity - P_bet
P_with %*% y
Q <- identity - P_bet
## c) within estimator and variance covariance matrix
#
Q%*%y
Q
X <- matrix(c(i,x), nrow = 6)
solve(t(X)%*%Q%*%X)%*%t(X)%*%Q%*%y
t(X)%*%Q%*%X
solve(t(X)%*%Q%*%X)
Xt <- t(X)
Xt%*%X
beta <- solve(t(x)%*%Q%*%x)%*%t(x)%*%Q%*%y
(lm1 <- lm(y ~ x, data = df))
df <- data.frame(x,y)
(lm1 <- lm(y ~ x, data = df))
X <- matrix(c(i,x), nrow = 6)
# transpose
Xt <- t(X)
# Matrix multiplication
XtX <- Xt%*%X
# (X'X)^-1
XtX1 <- solve(XtX)
# Projection Matrix = (X'X)^-1X'
P <- XtX1 %*% Xt
P
# beta
b <- P%*%y
b
b
y
X
res <- y - (X%*%b)
res
# sigma
t(res)%*%res / (3*2-(2+1))
# sigma
sigma <- t(res)%*%res / (3*2-(2+1))
# cov-matrix
cov-matrix <- sigma*solve(Xt%*%X)
# cov-matrix
cov-matrix <- solve(Xt%*%X)
# cov-matrix
cov_matrix <- sigma*solve(Xt%*%X)
# cov-matrix
cov_matrix <- solve(Xt%*%X)
# sigma
sigma <- t(res)%*%res / (3*2-(2+1))
# cov-matrix
cov_matrix <- sigma %*%solve(Xt%*%X)
View(sigma)
sigma <- t(res)%*%res / (3*2-(2+1))
# cov-matrix
cov_matrix <- 2.97 %*% solve(Xt%*%X)
# cov-matrix
cov_matrix <- 2.97 * solve(Xt%*%X)
# cov-matrix
cov_matrix <- sigma * solve(Xt%*%X)
res <- y - (X%*%b)
res
sd(lm1)
se(lm1)
summary(lm1)
res <- y - (X%*%b)
res
se(res)
sd(rs)
sd(res)
# sd
sigma <- sqrt(sigma2)
# Variance
sigma2 <- t(res)%*%res / (3*2-(2+1))
# sd
sigma <- sqrt(sigma2)
(lm1 <- lm(y ~ x, data = df))
summary(lm1)
mean(res)
res
4.440892e-16
-1.797-0.993+2.097+0.417+0.343-0.067
-0.02/6
sd(res)
sd(res)/sqrt(6)
sd(x)
mean(x)
5.477/sqrt(6)
sd(x)
x
sd(res)
sd(res)/sqrt(6)
cov_matrix <- 2.97 * solve(Xt%*%X)
View(cov_matrix)
sqrt(cov_matrix)
cov_matrix^2
#
xbar <- sum(x)
ybar <- sum(y)
x2 <- x^2
xy <- x*y
xy <- sum(x*y)
n <- 6
SSxx <- x^2 - x^2/n
SSxx <- sum(x^2) - sum(x)^2/n
xy <- x*y
SSxy <- xy(xy) - sum(x)sum(y)/n
SSxy <- sum(xy) - sum(x)sum(y)/n
SSxy <- sum(xy) - sum(x)*sum(y)/n
SSyy <- sum(y^2) - sum(y)^2/n
b
beta1 <- b[2,1]
SSE <- SSyy - beta1*SSxy
S <- sqrt(SSE/(n-2))
Sbeta1 <- S/sqrt(SSxx)
beta0 <- beta1 <- b[1,1]
SSE <- SSyy - beta0*SSxy
beta0 <- beta1 <- b[1,1]
SSE0 <- SSyy - beta0*SSxy
S0 <- sqrt(SSE/(n-2))
Sbeta0 <- S0/sqrt(SSxx)
beta0 <- beta1 <- b[1,1]
SSE0 <- SSyy - beta0*SSxy
S0 <- sqrt(SSE0/(n-2))
beta0 <- beta1 <- b[1,1]
beta0 <- beta1 <- b[1,1]
beta1 <- b[2,1]
beta0 <- b[1,1]
SSE0 <- SSyy - beta0*SSxy
S0 <- sqrt(SSE0/(n-2))
beta0 <- b[1,1]
SSE0 <- SSyy - beta0*SSxy
beta0*SSxy
SSyy
SSyy - beta0*SSxy
SSE0 <- SSyy - beta0*SSxy
S0 <- sqrt(SSE0/(n-2))
sqrt(SSE0/(n-2))
SSE0/(n-2)
sqrt(SSE0/(n-2))
SSE0/(n-2)
resbar <- sum(res)
SSE <- sum(res-resbar)
SSE <- sum(res^2)
S <- sqrt(SSE/(n-2))
sqrt(S)
S/sqrt(SSxx)
Sbeta0 <- S/sqrt(SSyy)
Sbeta0 <- S/sqrt(SSxy)
?lm()
lm1
?lm1
formals(lm1)
formals(lm)
lm1$data
lm1$coefficients
lm1$residuals
lm1$df.residual
lm1$effects
lm1$call
lm1$fitted.values
diag(S^2*solve(t(X)%*%X)
)
sqrt(diag(S^2*solve(t(X)%*%X)))
0.697/0.122
# SE
SE <- sqrt(diag(S^2*solve(t(X)%*%X)))
# t statistics
beta %/% SE
# t statistics
beta[1,1] %/% SE[1,1]
# t statistics
beta[1,1] / SE[1,1]
# t statistics
beta1 / SE[1,1]
# SE
SE <- sqrt(diag(S^2*solve(t(X)%*%X)))
# t statistics
beta1 / SE[[1]]
# t statistics
beta0 / SE[[1]]
beta1_tstatistic <- beta1 / SE[[2]]
# t statistics
beta0_tstatistic <- beta0 / SE[[1]]
t0 <- beta0 / SE[[1]]
t1 <- beta1 / SE[[2]]
solve(t(X)%*%X)%*%t(X)
P
t(res)%*%res
knitr::opts_chunk$set(echo = TRUE)
betawithin <- solve(t(x)%*%Q%*%x)%*%t(x)%*%Q%*%y
# covariance Matrix
reswithin <- y - (X%*%betawithin)
# variance-cov matrix
reswithin <- y - (x%*%betawithin)
SSEwithin <- sum(reswithin^2)
Swithin <- sqrt(SSE/(n-2))
S
SEwithin <- sqrt(diag(S^2*solve(t(X)%*%X)))
SEwithin <- sqrt(diag(Swithin^2*solve(t(X)%*%X)))
Swithin <- sqrt(SSEwithin/(n-2))
SEwithin <- sqrt(diag(Swithin^2*solve(t(X)%*%X)))
SEwithin <- sqrt(diag(Swithin^2*solve(t(x)%*%x)))
sigma2 <- t(res)%*%res / (3*2-(2+1))
sigma2 %*% solve(t(x)%*%x)
sigma2 <- t(res)%*%res / (3*2-(1+1))
sigma2 %*% solve(t(x)%*%x)
# variance-cov matrix
reswithin <- y - (x%*%betawithin)
beta
reswithin <- y - (x*betawithin)
# load packages
list.packages <- c("tidyverse","tidytuesdayR", "ggplot2", "dplyr", "patchwork")
for(i in list.packages) {
if(!require(i , character.only = TRUE)) install.packages(i)
library(i, character.only = TRUE)
}
rm(list.packages, i)
## load tt-data
tuesdata <- tidytuesdayR::tt_load('2021-12-21')
starbucks <- tuesdata$starbucks
starbucks$milktype <- ifelse(starbucks$milk == 0, "no milk",
ifelse(starbucks$milk %in% c(1,2,5), "milk", "plant"))
ggplot(starbucks) +
geom_jitter(aes(trans_fat_g, sugar_g, color = milktype), width = 0.2) +
labs( x = "Amount of Trans-Fat",
y = "Amount of Sugar",
color = "Contains") +
scale_colour_manual(values = c("red", "#327143", "#000000")) +
theme(legend.position = "top",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())
## tidy tuesday week 52 - starbucks
# clear environment
rm(list=ls())
# set working directory
setwd("~/Documents/GitHub/TidyTuesday/TidyTuesday")
# load packages
list.packages <- c("tidyverse","tidytuesdayR", "ggplot2", "dplyr", "patchwork")
for(i in list.packages) {
if(!require(i , character.only = TRUE)) install.packages(i)
library(i, character.only = TRUE)
}
rm(list.packages, i)
## load tt-data
tuesdata <- tidytuesdayR::tt_load('2021-12-21')
starbucks <- tuesdata$starbucks
starbucks$milktype <- ifelse(starbucks$milk == 0, "no milk",
ifelse(starbucks$milk %in% c(1,2,5), "milk", "plant"))
ggplot(starbucks) +
geom_jitter(aes(trans_fat_g, sugar_g, color = milktype), width = 0.2) +
labs( x = "Amount of Trans-Fat",
y = "Amount of Sugar",
color = "Contains") +
scale_colour_manual(values = c("red", "#327143", "#000000")) +
theme(legend.position = "top",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())
ggplot(starbucks) +
geom_jitter(aes(trans_fat_g, sugar_g, color = milktype), width = 0.2) +
labs( x = "Amount of Trans-Fat",
y = "Amount of Sugar",
color = "Contains") +
scale_colour_manual(values = c("red", "#327143", "#000000")) +
theme(legend.position = "top",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())
ggplot(starbucks) +
geom_jitter(aes(trans_fat_g, sugar_g, color = milktype), width = 0.2) +
labs( x = "Amount of Trans-Fat",
y = "Amount of Sugar",
color = "Contains") +
scale_colour_manual(values = c("red", "#327143", "#000000")) +
theme(legend.position = "bottom",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())
ggplot(starbucks) +
geom_jitter(aes(trans_fat_g, sugar_g, color = milktype), width = 0.2) +
labs( title = "Amount of Sugar and Trans-Fat in Starbucks drinks",
subtitle = "divided into drinks with milk, vegetable milk and without milk",
x = "Amount of Trans-Fat",
y = "Amount of Sugar",
color = "Contains",
caption = "Contribution to TidyTuesday (Week52) by Thomas Mock \n Data-Source: https://globalassets.starbucks.com/assets/94fbcc2ab1e24359850fa1870fc988bc.pdf"
) +
scale_colour_manual(values = c("red", "#327143", "#000000")) +
theme(legend.position = "bottom",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())
ggplot(starbucks) +
geom_jitter(aes(trans_fat_g, sugar_g, color = milktype), width = 0.2) +
labs( title = "Amount of Sugar and Trans-Fat in Starbucks Drinks",
subtitle = "divided into drinks with milk, vegetable milk and without milk",
x = "Amount of Trans-Fat",
y = "Amount of Sugar",
color = "Contains",
caption = "Contribution to TidyTuesday (Week52) by Thomas Mock \n Data-Source: https://globalassets.starbucks.com/assets/94fbcc2ab1e24359850fa1870fc988bc.pdf"
) +
scale_colour_manual(values = c("red", "#327143", "#000000")) +
theme(legend.position = "bottom",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = "blue")
ggplot(starbucks) +
geom_jitter(aes(trans_fat_g, sugar_g, color = milktype), width = 0.2) +
labs( title = "Amount of Sugar and Trans-Fat in Starbucks Drinks",
subtitle = "divided into drinks with milk, vegetable milk and without milk",
x = "Amount of Trans-Fat",
y = "Amount of Sugar",
color = "Contains",
caption = "Contribution to TidyTuesday (Week52) by Thomas Mock \n Data-Source: https://globalassets.starbucks.com/assets/94fbcc2ab1e24359850fa1870fc988bc.pdf"
) +
scale_colour_manual(values = c("red", "#327143", "#000000")) +
theme(legend.position = "bottom",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "lightblue",
colour = "lightblue",
size = 0.5, linetype = "solid"))
ggplot(starbucks) +
geom_jitter(aes(trans_fat_g, sugar_g, color = milktype), width = 0.2) +
labs( title = "Amount of Sugar and Trans-Fat in Starbucks Drinks",
subtitle = "divided into drinks with milk, vegetable milk and without milk",
x = "Amount of Trans-Fat",
y = "Amount of Sugar",
color = "Contains",
caption = "Contribution to TidyTuesday (Week52) by Thomas Mock \n Data-Source: https://globalassets.starbucks.com/assets/94fbcc2ab1e24359850fa1870fc988bc.pdf"
) +
scale_colour_manual(values = c("red", "#327143", "#000000")) +
theme(legend.position = "bottom",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "lightblue",
colour = "lightblue",
linetype = "solid"))
ggplot(starbucks) +
geom_jitter(aes(trans_fat_g, sugar_g, color = milktype)) +
labs( title = "Amount of Sugar and Trans-Fat in Starbucks Drinks",
subtitle = "divided into drinks with milk, vegetable milk and without milk",
x = "Amount of Trans-Fat",
y = "Amount of Sugar",
color = "Contains",
caption = "Contribution to TidyTuesday (Week52) by Thomas Mock \n Data-Source: https://globalassets.starbucks.com/assets/94fbcc2ab1e24359850fa1870fc988bc.pdf"
) +
scale_colour_manual(values = c("red", "#327143", "#000000")) +
theme(legend.position = "bottom",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "lightblue",
colour = "lightblue",
linetype = "solid"))
unique(starbucks$trans_fat_g)
starbucks <- ifelse(starbucks$trans_fat_g != "02")
starbucks <- subset(starbucks,trans_fat_g != "02")
ggplot(starbucks) +
geom_jitter(aes(trans_fat_g, sugar_g, color = milktype), width = 0.2) +
labs( title = "Amount of Sugar and Trans-Fat in Starbucks Drinks",
subtitle = "divided into drinks with milk, vegetable milk and without milk",
x = "Amount of Trans-Fat",
y = "Amount of Sugar",
color = "Contains",
caption = "Contribution to TidyTuesday (Week52) by Thomas Mock \n Data-Source: https://globalassets.starbucks.com/assets/94fbcc2ab1e24359850fa1870fc988bc.pdf"
) +
scale_colour_manual(values = c("red", "#327143", "#000000")) +
theme(legend.position = "bottom",
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "lightblue",
colour = "lightblue",
linetype = "solid"))
ggsave("992_TidyTuesdayWeek52.png")
